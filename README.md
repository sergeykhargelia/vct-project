# Regular Expenses Tracker

## Основная идея

Идея моего проекта довольно простая: есть некоторые траты, которые происходят регулярно, это могут быть коммунальные платежи, подписки на различные онлайн-сервисы и так далее. Хочется, во-первых, не забывать об этих платежах (например, чтобы вовремя отменить пробную подписку в онлайн сервисе), а во-вторых, иметь место, где они собраны, чтобы можно было посмотреть на ближайшие платежи или статистику за последние месяцы. 

Таким образом, мой сервис будет агрегировать регулярные платежи пользователя, отслеживать состоявшиеся платежи, показывать информацию о них на веб-странице, а также присылать уведомление по электронной почте накануне очередного платежа. 

## Выбор платформы и стека

В качестве облачного провайдера я выбрал `Yandex Cloud`, поскольку для иностранных сервисов очень вероятны проблемы с привязкой российской карты, а, например, в `VK Cloud` я не нашёл, как получить грант на тестирование, если ты являешься физическим лицом. `Yandex Cloud` предоставляет `4000` рублей на два месяца, чего было вполне достаточно для моих целей. 

Что касается стека, бэкенд я решил писать на `Golang`, а веб-страницу рендерить с помощью связки `HTMX` и `Go templates`. Таким образом, в ответ на `HTTP` запросы от клиента эндпоинты сразу возвращают куски `HTML`. Выбор стека обусловлен его минималистичностью, а также тем, что `Golang` хорошо подходит именно для задач такого вида. В качестве базы данных я выбрал `PostgreSQL` (в том числе и потому, что там из коробки поддержаны временные интервалы), я взаимодействую с базой данных из кода бэкенда с помощью обёртки `GORM`. Для аутентификации я использую `JWT`. 

## Структурная схема

### Публичные эндпоинты

| Метод | Эндпоинт  | Описание                           |
| ----- | --------- | ---------------------------------- |
| POST  | /register | Регистрация нового пользователя    |
| POST  | /login    | Аутентификация пользователя        |
| GET   | /register | Страница формы регистрации         |
| GET   | /login    | Страница формы входа               |
| GET   | /health   | Проверка работоспособности сервера |

### Защищённые эндпоинты

| Метод  | Эндпоинт                               | Описание                                          |
| ------ | -------------------------------------- | ------------------------------------------------- |
| GET    | /                                      | Главная страница пользователя                     |
| POST   | /regular_expenses                      | Создание регулярного расхода                      |
| GET    | /regular_expenses                      | Получение списка регулярных расходов пользователя |
| DELETE | /regular_expenses/{regular_expense_id} | Удаление регулярного расхода по ID                |
| GET    | /expenses                              | Получение списка всех расходов пользователя       |

### Схема базы данных

#### Таблица `users`

| Поле          | Тип          | Ограничения      | Описание                 |
| ------------- | ------------ | ---------------- | ------------------------ |
| id            | BIGSERIAL    | PRIMARY KEY      | Уникальный идентификатор |
| email         | VARCHAR(255) | UNIQUE, NOT NULL | Email пользователя       |
| name          | VARCHAR(255) | NOT NULL         | Имя пользователя         |
| password_hash | VARCHAR(255) | NOT NULL         | Хэш пароля               |

#### Таблица `regular_expenses`

| Поле        | Тип         | Ограничения                     | Описание                                                                              |
|-------------|-------------|---------------------------------|---------------------------------------------------------------------------------------|
| id          | BIGSERIAL   | PRIMARY KEY                     | Уникальный идентификатор расхода                                                      |
| user_id     | BIGINT      | INDEX, FOREIGN KEY -> users(id) | Владелец расхода                                                                      |
| name        | VARCHAR(50) | NOT NULL                        | Название расхода                                                                      |
| description | TEXT        |                                 | Расширенное описание                                                                  |
| next_date   | DATE        | INDEX, NULLABLE                 | Дата следующего списания/платежа (либо NULL, если расход удалён из списка регулярных) |
| frequency   | INTERVAL    |                                 | Периодичность (например '1 month')                                                    |
| amount      | INTEGER     | NOT NULL                        | Сумма расхода в рублях                                                  |


#### Таблица `expenses`

| Поле               | Тип       | Ограничения                                | Описание                                |
| ------------------ | --------- | ------------------------------------------ | --------------------------------------- |
| id                 | BIGSERIAL | PRIMARY KEY                                | Уникальный идентификатор                |
| user_id            | BIGINT    | INDEX, FOREIGN KEY -> users(id)            | Владелец расхода                        |
| regular_expense_id | BIGINT    | INDEX, FOREIGN KEY -> regular_expenses(id) | Связанный регулярный платеж  |
| date               | DATE      | NOT NULL                                   | Дата фактического платежа               |